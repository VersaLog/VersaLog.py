name: Discord Pull Request and Issue Notification

on:
  pull_request:
    types: [opened, closed, reopened, assigned, review_requested]
  issues:
    types: [opened, closed, reopened, assigned, labeled, unlabeled]

jobs:
  send_notification:
    runs-on: ubuntu-latest

    steps:
      - name: Send Discord Notification
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        run: |
          set -e
          echo "Preparing to send message to Discord..."

          # Remove line breaks and spaces (to prevent curl errors)
          DISCORD_WEBHOOK=$(echo "$DISCORD_WEBHOOK" | tr -d '\r\n[:space:]')

          EVENT="${{ github.event.action }}"
          USER="${{ github.actor }}"
          EVENT_NAME="${{ github.event_name }}"
          MESSAGE=""

          echo "EVENT=$EVENT"
          echo "EVENT_NAME=$EVENT_NAME"

          if [ "$EVENT_NAME" = "pull_request" ]; then
            PR_NUMBER="${{ github.event.pull_request.number }}"
            PR_TITLE="${{ github.event.pull_request.title }}"
            PR_URL="${{ github.event.pull_request.html_url }}"
            PR_MERGED="${{ github.event.pull_request.merged }}"

            case "$EVENT" in
              opened)
                MESSAGE="ğŸ“¢ **Pull Request #${PR_NUMBER}** has been created!\nğŸ‘¤ Author: ${USER}\nğŸ“„ Title: ${PR_TITLE}\nğŸ”— URL: ${PR_URL}"
                ;;
              closed)
                if [ "$PR_MERGED" = "true" ]; then
                  MESSAGE="ğŸ‰ **Pull Request #${PR_NUMBER}** has been merged!\nğŸ‘¤ By: ${USER}\nğŸ“„ Title: ${PR_TITLE}\nğŸ”— URL: ${PR_URL}"
                else
                  MESSAGE="âŒ **Pull Request #${PR_NUMBER}** has been closed!\nğŸ‘¤ By: ${USER}\nğŸ“„ Title: ${PR_TITLE}\nğŸ”— URL: ${PR_URL}"
                fi
                ;;
              reopened)
                MESSAGE="ğŸ”„ **Pull Request #${PR_NUMBER}** has been reopened!\nğŸ‘¤ By: ${USER}\nğŸ“„ Title: ${PR_TITLE}\nğŸ”— URL: ${PR_URL}"
                ;;
              assigned)
                MESSAGE="ğŸ™‹ **Pull Request #${PR_NUMBER}** has been assigned to ${USER}!\nğŸ“„ Title: ${PR_TITLE}\nğŸ”— URL: ${PR_URL}"
                ;;
              review_requested)
                REVIEWER="${{ github.event.requested_reviewer.login }}"
                MESSAGE="ğŸ‘€ **Pull Request #${PR_NUMBER}** review has been requested from ${REVIEWER}!\nğŸ‘¤ By: ${USER}\nğŸ“„ Title: ${PR_TITLE}\nğŸ”— URL: ${PR_URL}"
                ;;
              *)
                MESSAGE="â“ Unknown Pull Request event: ${EVENT}"
                ;;
            esac

          elif [ "$EVENT_NAME" = "issues" ]; then
            ISSUE_NUMBER="${{ github.event.issue.number }}"
            ISSUE_TITLE="${{ github.event.issue.title }}"
            ISSUE_URL="${{ github.event.issue.html_url }}"

            case "$EVENT" in
              opened)
                MESSAGE="ğŸ› **Issue #${ISSUE_NUMBER}** has been created!\nğŸ‘¤ Author: ${USER}\nğŸ“„ Title: ${ISSUE_TITLE}\nğŸ”— URL: ${ISSUE_URL}"
                ;;
              closed)
                MESSAGE="âœ… **Issue #${ISSUE_NUMBER}** has been closed!\nğŸ‘¤ By: ${USER}\nğŸ“„ Title: ${ISSUE_TITLE}\nğŸ”— URL: ${ISSUE_URL}"
                ;;
              reopened)
                MESSAGE="ğŸ”„ **Issue #${ISSUE_NUMBER}** has been reopened!\nğŸ‘¤ By: ${USER}\nğŸ“„ Title: ${ISSUE_TITLE}\nğŸ”— URL: ${ISSUE_URL}"
                ;;
              assigned)
                ASSIGNEE="${{ github.event.assignee.login }}"
                MESSAGE="ğŸ™‹ **Issue #${ISSUE_NUMBER}** has been assigned to ${ASSIGNEE}!\nğŸ‘¤ By: ${USER}\nğŸ“„ Title: ${ISSUE_TITLE}\nğŸ”— URL: ${ISSUE_URL}"
                ;;
              labeled)
                LABEL="${{ github.event.label.name }}"
                MESSAGE="ğŸ·ï¸ **Issue #${ISSUE_NUMBER}** has been labeled with '${LABEL}'!\nğŸ‘¤ By: ${USER}\nğŸ“„ Title: ${ISSUE_TITLE}\nğŸ”— URL: ${ISSUE_URL}"
                ;;
              unlabeled)
                LABEL="${{ github.event.label.name }}"
                MESSAGE="ğŸ·ï¸ **Issue #${ISSUE_NUMBER}** label '${LABEL}' has been removed!\nğŸ‘¤ By: ${USER}\nğŸ“„ Title: ${ISSUE_TITLE}\nğŸ”— URL: ${ISSUE_URL}"
                ;;
              *)
                MESSAGE="â“ Unknown Issue event: ${EVENT}"
                ;;
            esac
          else
            MESSAGE="â“ Unknown event type: ${EVENT_NAME}"
          fi

          echo "Sending message to Discord..."
          echo "--------------------------------"
          echo "$MESSAGE"
          echo "--------------------------------"

          # Send to Discord
          curl -X POST \
            -H "Content-Type: application/json" \
            -d "{\"content\": \"$MESSAGE\"}" \
            "$DISCORD_WEBHOOK"
