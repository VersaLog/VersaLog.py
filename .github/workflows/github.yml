name: Discord Notification

on:
  issues:
    types: [opened, closed, reopened]
  pull_request:
    types: [opened, closed, reopened]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send message to Discord
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
          GITHUB_EVENT_NAME: ${{ github.event_name }}
          ACTION: ${{ github.event.action }}
          ACTOR: ${{ github.actor }}
          TITLE: ${{ github.event.pull_request.title || github.event.issue.title }}
          NUMBER: ${{ github.event.pull_request.number || github.event.issue.number }}
          URL: ${{ github.event.pull_request.html_url || github.event.issue.html_url }}
        run: |
          set -e
          echo "Sending message to Discord..."

          DISCORD_WEBHOOK=$(echo "$DISCORD_WEBHOOK" | tr -d '\r\n ')

          if [ "$GITHUB_EVENT_NAME" = "issues" ]; then
            CONTENT="ðŸ“¢ Issue #$NUMBER $ACTION by $ACTOR\n**$TITLE**\n$URL"
          elif [ "$GITHUB_EVENT_NAME" = "pull_request" ]; then
            CONTENT="ðŸ“¢ Pull Request #$NUMBER $ACTION by $ACTOR\n**$TITLE**\n$URL"
          else
            CONTENT="ðŸ”” Unknown event triggered by $ACTOR"
          fi

          curl -H "Content-Type: application/json" \
               -X POST \
               -d "{\"content\": \"$CONTENT\"}" \
               "$DISCORD_WEBHOOK"